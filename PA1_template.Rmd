---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---
```{r setup}
# set global chunk options: 
library(knitr)
opts_chunk$set( cache=TRUE , cache.path = 'PA1_template_files/', fig.path='PA1_template_files/figure-html/') 
```

## Loading and preprocessing the data

```{r Preprocessing, echo = TRUE , message=FALSE , warning=FALSE , fig.keep='all'}
# Get Data
setwd("activity")
amd <- read.csv("activity.csv" , header = TRUE)
setwd("..")

# Change date class from factor of strings to DATE class  
levels(amd$date) <- as.Date(levels(amd$date))
amd$date <- as.Date(amd$date)

#change interval class from integer to factor
amd$interval <- as.factor(amd$interval)

#Remove NA values in amd2
amd2 <- amd[!(is.na(amd$steps)|is.na(amd$date)|is.na(amd$interval)),]
```

## What is mean total number of steps taken per day?

```{r Total Daily Steps, echo = TRUE, dev ='png' ,fig.height = 4 , fig.width = 8 ,fig.allign ='center', fig.show='asis' , eval=TRUE, message=FALSE , warning=FALSE , fig.keep='all'}


# summarize and plot
library("plyr")
library("ggplot2")
summ <- ddply(amd2, .(date),summarize,steps = sum(steps))
png(file = "Total Daily Steps.png")
q <- qplot(steps, data=summ , geom = "histogram", xlab = "Daily Steps" , 
             ylab = "Frequency" ,main = "Total Daily Steps")+
      geom_histogram(aes(fill = ..count..)) + 
      scale_fill_gradient("Count", low = "green", high = "red")
print(q)
dev.off()

meansteps <- mean(summ$steps)
mediansteps <- median(summ$steps)
```
The mean of total number of steps `r meansteps` and meadian is `r mediansteps`

## What is the average daily activity pattern?
```{r Average Daily Steps, echo = TRUE, dev ='png' ,fig.height = 4 , fig.width = 8 ,fig.allign ='center', fig.show='asis' }
# summarize and plot
library("plyr")
library("ggplot2")
summ <- ddply(amd2, .(interval),summarize,steps = mean(steps))

png(file = "Average Daily Activity Pattern.png")

q <- qplot(interval,steps,data = summ, geom = c("point","line"),xlab = "Daily Time Interval",ylab ="Average steps", main= "Average Daily Activity Pattern")
print(q)
dev.off()

chk <- summ$steps == max(summ$steps)
summ[chk,]

```
## Imputing missing values

```{r imputing missing value , echo = TRUE, dev ='png' ,fig.height = 4 , fig.width = 8 ,fig.allign ='center', fig.show='asis'}
print(c("number of NA in steps :", sum(is.na(amd$steps))))
print(c("number of NA in date :", sum(is.na(amd$date))))
print(c("number of NA in interval :", sum(is.na(amd$interval))))

print("Impute principle for steps : Average daily interval activity" )
library("plyr")
lookup<- ddply(amd2, .(interval),summarize,steps = mean(steps))
newamd <- amd
for (i in 1:nrow(newamd))
    if (is.na(newamd[i,1]))
        newamd[i,1] = lookup[lookup$interval == newamd[i,3],2]
# histogram for number of steps

library("ggplot2")
summ <- ddply(newamd, .(date),summarize,steps = sum(steps))
png(file = "Imputed Data Total Daily Steps.png")
q <- qplot(steps, data=summ , geom = "histogram", xlab = "Daily Steps" , 
             ylab = "Frequency" ,main = "Imputed Data :Total Daily Steps")+
      geom_histogram(aes(fill = ..count..)) + 
      scale_fill_gradient("Count", low = "green", high = "red")
print(q)
dev.off()
meansteps <- mean(summ$steps)
mediansteps <- median(summ$steps)

```
The mean of total number of steps `r meansteps` and meadian is `r mediansteps`

## Are there differences in activity patterns between weekdays and weekends?
```{r weekend and weekdays}
library("plyr")
summ <- ddply(newamd,.(date,days = weekdays(date)),summarize,steps = sum(steps))
summ <- ddply(summ, .(days),summarize,steps = mean(steps))
x <- data.frame( num =1:7 ,days = c("Sunday", "Monday","Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
summ <- merge(summ,x)
summ <- summ[order(summ$num),]
summ[,1:2]


```
